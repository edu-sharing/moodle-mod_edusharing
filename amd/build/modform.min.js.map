{"version":3,"file":"modform.min.js","sources":["../src/modform.js"],"sourcesContent":["import {getTicket} from \"./repository\";\n\nexport const init = async(repoUrl, mediatype, hasRendering2) => {\n    const gradeForm = document.getElementById('id_modstandardgrade');\n    const gradeCompletionInput = document.getElementById('id_completionusegrade')?.closest('.row.fitem');\n    if (mediatype !== 'file-h5p' || !hasRendering2) {\n        if (gradeForm !== null) {\n            gradeForm.classList.add('d-none');\n        }\n        if (gradeCompletionInput !== null) {\n            gradeCompletionInput.classList.add('d-none');\n        }\n    }\n    if (typeof window.openRepo !== 'function') {\n        window.openRepo = function(url) {\n            window.addEventListener('message', function handleRepo(event) {\n                if (event.data.event === 'APPLY_NODE') {\n                    const node = event.data.data;\n                    const isH5p = node.mediatype === 'file-h5p';\n                    if (isH5p && hasRendering2 && gradeForm !== null && gradeCompletionInput !== null) {\n                        gradeForm.classList.remove('d-none');\n                        gradeCompletionInput.classList.remove('d-none');\n                    } else {\n                        const gradeTypeSelect = document.getElementById('id_grade_modgrade_type');\n                        gradeTypeSelect.value = 'none';\n                        gradeTypeSelect.dispatchEvent(new Event('change', {bubbles: true}));\n                    }\n                    window.win.close();\n                    window.document.getElementById('id_object_url').value = node.objectUrl;\n                    let title = node.title;\n                    if (!title) {\n                        title = node.properties['cm:name'];\n                    }\n                    let version = -1;\n                    let versionArray = node.properties['cclom:version'];\n                    if (versionArray !== undefined) {\n                        version = node.properties['cclom:version'][0];\n                        window.document.getElementById('id_object_version_1').value = version;\n                    }\n                    let aspects = node.aspects;\n                    if (aspects.includes('ccm:published') || aspects.includes('ccm:collection_io_reference') || version === -1) {\n                        window.document.getElementById('id_object_version_0').checked = true;\n                        window.document.getElementById('id_object_version_1').closest('label').hidden = true;\n                    } else {\n                        window.document.getElementById('id_object_version_1').closest('label').hidden = false;\n                    }\n                    window.document.getElementById('fitem_id_object_title')\n                        .getElementsByClassName('form-control-static')[0].innerHTML = title;\n                    if (window.document.getElementById('id_name').value === '') {\n                        window.document.getElementById('id_name').value = title;\n                    }\n                    window.removeEventListener('message', handleRepo, false );\n                }\n            }, false);\n            window.win = window.open(url);\n        };\n    }\n    const repoSearch = new URL(repoUrl + '/components/search?applyDirectories=false&reurl=WINDOW');\n    const repoWorkspace = new URL(repoUrl + '/components/workspace/files?applyDirectories=false&reurl=WINDOW');\n    const repoCollections = new URL(repoUrl + '/components/collections?applyDirectories=false&reurl=WINDOW');\n    const ajaxParams = {\n        eduTicketStructure: {\n            courseId: 0\n        }\n    };\n    const repoSearchButton = document.getElementById('id_edu_search_button');\n    repoSearchButton.addEventListener('click', async() => {\n        const ticket = await getTicket(ajaxParams);\n        const repoSearchWithTicket = new URL(repoSearch);\n        repoSearchWithTicket.searchParams.set('ticket', ticket.ticket);\n        window.openRepo(repoSearchWithTicket.toString());\n    });\n    const repoWorkspaceButton = document.getElementById('id_edu_workspace_button');\n    if (repoWorkspaceButton !== null) {\n        repoWorkspaceButton.addEventListener('click', async() => {\n            const ticket = await getTicket(ajaxParams);\n            const repoWorkspaceWithTicket = new URL(repoWorkspace);\n            repoWorkspaceWithTicket.searchParams.set('ticket', ticket.ticket);\n            window.openRepo(repoWorkspaceWithTicket.toString());\n        });\n    }\n    const repoCollectionsButton = document.getElementById('id_edu_collections_button');\n    if (repoCollectionsButton !== null) {\n        repoCollectionsButton.addEventListener('click', async() => {\n            const ticket = await getTicket(ajaxParams);\n            const repoCollectionsWithTicket = new URL(repoCollections);\n            repoCollectionsWithTicket.searchParams.set('ticket', ticket.ticket);\n            window.openRepo(repoCollectionsWithTicket.toString());\n        });\n    }\n};\n"],"names":["async","repoUrl","mediatype","hasRendering2","gradeForm","document","getElementById","gradeCompletionInput","_document$getElementB","closest","classList","add","window","openRepo","url","addEventListener","handleRepo","event","data","node","remove","gradeTypeSelect","value","dispatchEvent","Event","bubbles","win","close","objectUrl","title","properties","version","undefined","aspects","includes","checked","hidden","getElementsByClassName","innerHTML","removeEventListener","open","repoSearch","URL","repoWorkspace","repoCollections","ajaxParams","eduTicketStructure","courseId","ticket","repoSearchWithTicket","searchParams","set","toString","repoWorkspaceButton","repoWorkspaceWithTicket","repoCollectionsButton","repoCollectionsWithTicket"],"mappings":"sLAEoBA,MAAMC,QAASC,UAAWC,iDACpCC,UAAYC,SAASC,eAAe,uBACpCC,mDAAuBF,SAASC,eAAe,iEAAxBE,sBAAkDC,QAAQ,cACrE,aAAdP,WAA6BC,gBACX,OAAdC,WACAA,UAAUM,UAAUC,IAAI,UAEC,OAAzBJ,sBACAA,qBAAqBG,UAAUC,IAAI,WAGZ,mBAApBC,OAAOC,WACdD,OAAOC,SAAW,SAASC,KACvBF,OAAOG,iBAAiB,WAAW,SAASC,WAAWC,UAC1B,eAArBA,MAAMC,KAAKD,MAAwB,OAC7BE,KAAOF,MAAMC,KAAKA,QACS,aAAnBC,KAAKjB,WACNC,eAA+B,OAAdC,WAA+C,OAAzBG,qBAChDH,UAAUM,UAAUU,OAAO,UAC3Bb,qBAAqBG,UAAUU,OAAO,cACnC,OACGC,gBAAkBhB,SAASC,eAAe,0BAChDe,gBAAgBC,MAAQ,OACxBD,gBAAgBE,cAAc,IAAIC,MAAM,SAAU,CAACC,SAAS,KAEhEb,OAAOc,IAAIC,QACXf,OAAOP,SAASC,eAAe,iBAAiBgB,MAAQH,KAAKS,cACzDC,MAAQV,KAAKU,MACZA,QACDA,MAAQV,KAAKW,WAAW,gBAExBC,SAAW,OAEMC,IADFb,KAAKW,WAAW,mBAE/BC,QAAUZ,KAAKW,WAAW,iBAAiB,GAC3ClB,OAAOP,SAASC,eAAe,uBAAuBgB,MAAQS,aAE9DE,QAAUd,KAAKc,QACfA,QAAQC,SAAS,kBAAoBD,QAAQC,SAAS,iCAA+C,IAAbH,SACxFnB,OAAOP,SAASC,eAAe,uBAAuB6B,SAAU,EAChEvB,OAAOP,SAASC,eAAe,uBAAuBG,QAAQ,SAAS2B,QAAS,GAEhFxB,OAAOP,SAASC,eAAe,uBAAuBG,QAAQ,SAAS2B,QAAS,EAEpFxB,OAAOP,SAASC,eAAe,yBAC1B+B,uBAAuB,uBAAuB,GAAGC,UAAYT,MACV,KAApDjB,OAAOP,SAASC,eAAe,WAAWgB,QAC1CV,OAAOP,SAASC,eAAe,WAAWgB,MAAQO,OAEtDjB,OAAO2B,oBAAoB,UAAWvB,YAAY,OAEvD,GACHJ,OAAOc,IAAMd,OAAO4B,KAAK1B,aAG3B2B,WAAa,IAAIC,IAAIzC,QAAU,0DAC/B0C,cAAgB,IAAID,IAAIzC,QAAU,mEAClC2C,gBAAkB,IAAIF,IAAIzC,QAAU,+DACpC4C,WAAa,CACfC,mBAAoB,CAChBC,SAAU,IAGO1C,SAASC,eAAe,wBAChCS,iBAAiB,SAASf,gBACjCgD,aAAe,yBAAUH,YACzBI,qBAAuB,IAAIP,IAAID,YACrCQ,qBAAqBC,aAAaC,IAAI,SAAUH,OAAOA,QACvDpC,OAAOC,SAASoC,qBAAqBG,qBAEnCC,oBAAsBhD,SAASC,eAAe,2BACxB,OAAxB+C,qBACAA,oBAAoBtC,iBAAiB,SAASf,gBACpCgD,aAAe,yBAAUH,YACzBS,wBAA0B,IAAIZ,IAAIC,eACxCW,wBAAwBJ,aAAaC,IAAI,SAAUH,OAAOA,QAC1DpC,OAAOC,SAASyC,wBAAwBF,qBAG1CG,sBAAwBlD,SAASC,eAAe,6BACxB,OAA1BiD,uBACAA,sBAAsBxC,iBAAiB,SAASf,gBACtCgD,aAAe,yBAAUH,YACzBW,0BAA4B,IAAId,IAAIE,iBAC1CY,0BAA0BN,aAAaC,IAAI,SAAUH,OAAOA,QAC5DpC,OAAOC,SAAS2C,0BAA0BJ"}
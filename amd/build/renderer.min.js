define("mod_edusharing/renderer",["exports","core/config","./repository"],(function(_exports,_config,_repository){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.renderObject=_exports.init=void 0,_config=(obj=_config)&&obj.__esModule?obj:{default:obj};_exports.init=async repoUrl=>{const element=document.getElementById("edusharing_view");window.addEventListener("message",(async e=>{if(!e.data||"H5P_XAPI"!==e.data.type)return;const moodleUser=await(0,_repository.getCurrentUser)().catch((error=>{window.console.error(error)})),statement=e.data.statement;window.console.log("statement:"),window.console.log(statement),statement.object.id=window.location.href,statement.actor.mbox="mailto:".concat(moodleUser.email),window.console.log("statement after:"),window.console.log(statement);const ajaxParams={component:"mod_edusharing",requestjson:JSON.stringify(statement)};(0,_repository.sendXapiStatement)(ajaxParams)})),await renderObject(element,repoUrl)};const renderObject=async(element,repoUrl)=>{const wrapper=element.parentElement;if(!wrapper)return;const width=element.getAttribute("data-width"),nodeId=element.getAttribute("data-node"),containerId=element.getAttribute("data-container"),version=element.getAttribute("data-version"),usage=element.getAttribute("data-usage"),resourceId=element.getAttribute("data-resource"),resourceUrl="".concat(_config.default.wwwroot,"/mod/edusharing/contentRedirect.php?")+"nodeId=".concat(nodeId,"&nodeVersion=").concat(version,"&usageId=").concat(usage,"&resourceId=").concat(resourceId,"&containerId=").concat(containerId),ajaxParams={eduSecuredNodeStructure:{nodeId:nodeId,resourceId:resourceId,version:version}},response=await(0,_repository.getSecuredNode)(ajaxParams).catch((error=>{window.console.error(error)})),customWidth=response.customWidth;customWidth?"none"!==customWidth&&(wrapper.style.width=customWidth):wrapper.style.width=width?width+"px":"";const moodleUser=await(0,_repository.getCurrentUser)().catch((error=>{window.console.error(error)})),eduUser={authorityName:moodleUser.username,firstName:moodleUser.firstname,surName:moodleUser.lastname,userEMail:moodleUser.email},serviceWorkerPhp="".concat(_config.default.wwwroot,"/mod/edusharing/getServiceWorker.php");"serviceWorker"in navigator&&(await navigator.serviceWorker.register(serviceWorkerPhp,{scope:"/"}),await navigator.serviceWorker.ready);const renderComponent=document.createElement("edu-sharing-render");renderComponent.classList.add("edu-sharing-render"),renderComponent.encoded_node=response.securedNode,renderComponent.signature=response.signature,renderComponent.jwt=response.jwt,renderComponent.render_url=response.renderingBaseUrl,renderComponent.encoded_user=btoa(JSON.stringify(eduUser)),renderComponent.service_worker_url=serviceWorkerPhp,renderComponent.activate_service_worker=!1,renderComponent.assets_url=repoUrl+"/web-components/rendering-service-amd/assets",renderComponent.resource_url=resourceUrl,renderComponent.preview_url=response.previewUrl,wrapper.innerHTML="",wrapper.appendChild(renderComponent)};_exports.renderObject=renderObject}));

//# sourceMappingURL=renderer.min.js.map